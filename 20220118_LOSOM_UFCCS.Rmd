---
title: "LOSOM"
author: "Paul Julian"
output:
  xaringan::moon_reader:
    css: ["default", "libs/WhiteBlue.css"]
    lib_dir: libs
    nature:
      slideNumberFormat: "%current%" 
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 4:3
    seal: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(knitr)

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo=FALSE)

##
library(flextable)
library(magrittr)
library(plyr)
library(reshape2)

wd="C:/Julian_LaCie/_Github/LOSOM_ModelEval"

plot.path="C:/Julian_LaCie/_Github/LOSOM_ModelEval/Plots/"
export.path="C:/Julian_LaCie/_GitHub/LOSOM_ModelEval/Export/"

# Data analysis in 
# ./src/_iter3_final/iter3_array_eval_UFPresentation.R
```

layout: true

<div class="my-footer">
<span>  </span>
</div>

---
name: title
class: left, middle

### Lake Okeechobee System Operating Manual


.pull-left[
#### Presentation to UF - Center for Coastal Solutions

*Sanibel-Captiva Conservation Foundation*

*Conservancy of Southwest Florida*

`r paste(format(as.Date("2021-01-18"),"%B %d, %Y"))#,"<br>(Updated:", format(as.Date(Sys.Date()),"%B %d, %Y"),")")`

]
<!-- this ends up being the title slide since seal = FALSE-->
  
.pull-right[
```{r ,fig.align="center",out.width="40%"}
    knitr::include_graphics('./Plots/SCCF Logo knockout_c.png')
```
    
```{r ,fig.align="center",out.width="40%"}
    knitr::include_graphics('./Plots/ConSWFL.jpeg')
```
    
]


```{r xaringanExtra, include=FALSE, warnint=FALSE}
# devtools::install_github("gadenbuie/xaringanExtra")
# xaringanExtra::use_webcam()
xaringanExtra::use_tile_view()
# xaringanExtra::use_scribble()
```
.footnote[
<!-- Paul Julian PhD<br>[`r fontawesome::fa("fas fa-envelope")`](mailto: pjulian@sccf.org) .small[pjulian@sccf.org] -->

.small[Use cursor keys for navigation, press .red["O"] for a slide .red[O]verview]

```{r} 
bsplus::bs_button(
    label = "Download PDF Version",
    button_type = "primary",
    button_size = "small") %>%
    htmltools::a(
      href = "https://sccf-tech.github.io/slides/LOSOM/20220118_LOSOM_UFCCS.pdf"
      )
```
]

---
name: LOSOM

```{r ,fig.align="center",out.width="100%"}

knitr::include_graphics('./Plots/process/LOSOM_objective_20211116.png')
```

.small[
*From USACE PDT 16 Nov 2021 meeting presentation*
]

---
name: LOSOMProcess

### LOSOM Process and Timeline

* LOSOM process started with Scoping Meetings - Feb 2019
* LOSOM Public Workshops – Sept 2019


```{r ,fig.align="center",out.width="100%"}

knitr::include_graphics('./Plots/process/USACE_LOSOM_steps1_5.png')
```

.small[
*From USACE PDT 09 Aug 2021 meeting presentation*
]

---
name: LOSOMProcess

### Iteration 2 Plans


```{r ,fig.align="center",out.width="100%"}

knitr::include_graphics('./Plots/process/Iter2_plans.png')
```

.small[
*From SFWMD 08 July 2021 Governing Board meeting Presentation*
]


---
name: LOSOMProcess

### Iteration 3

```{r ,fig.align="center",out.width="100%"}

knitr::include_graphics('./Plots/process/LOSOM_Iter3_Batchruns.png')
```

.small[
*From USACE PDT 16 Nov 2021 meeting presentation*
]


---
name: USACE_estuary2

### Iteration 3 - Phase 2

```{r ,fig.align="center",out.width="85%",fig.cap="Comparison of stress and damaging flow event counts for Caloosahatchee (CRE) and St Lucie (SLE) estuaries of ~240k runs, USACE selected runs and TSP."}

knitr::include_graphics('./Plots/Iteration3_Batch/Est_StressDam_USACEsubset_TSP.png')
```


---
name: alternatives

### Iteration 3 - Phase 3<br>.small[TSP Model runs]

```{r}
data.frame(Alternative=c("ECB19","NA22f","NA25f","PA22","PA25"),
           Description=c(
             "LOSOM Existing Conditions Baseline 2019 with LORS08",
             "LOSOM No Action 2022 (HHD Rehab Complete, C-44 Reservoir & STA) with LORS08",
             "LOSOM No Action 2025 (HHD Rehab Complete, C-44 Reservoir & STA, C-43 Reservoir, A-2 STA (grown in only)) with LORS08",
             "Preferred Alterative 2022. Distinct operational zones and regulatory disharge rates selected based on LOSOM objectives",
             "Preferred Alterative 2025. Distinct operational zones and regulatory disharge rates selected based on LOSOM objectives"
           ))%>%
  flextable()%>%
  colformat_char(na_str="---")%>%
  width(width=c(1,5))%>%
  padding(padding=0.1,part="all")%>%
  font(fontname="Times New Roman",part="all")%>%
  fontsize(size=10,part="body")%>%
  fontsize(size=12,part="header")%>%
  bold(part="header")%>%
  footnote(i=c(1,2,3),j=1,
           value=as_paragraph(c("Existing Conditions Baseline 2019","No Action Condition 2022", "No Action Condition 2025")),
           ref_symbols = c(" 1 "," 2 "," 3"),part="body")
```

* For today's purpose we will focus on the PA2025 (Preferred Alternative 2025 iteration).
  * Comparison of both NA22f/PA22 and NA25f/PA25 can be found here [link](https://sccf-tech.github.io/slides/LOSOM/SCCF_iter3_prefalt.html). 

* Modeling done using the Regional Simulation Model Basins (RSM-BN) with extended period of record (1965 - 2016)

.small[SFWMD RSM Webpage - [link](https://www.sfwmd.gov/science-data/rsm-model)]

---
name: RSM
class: inverse middle

### RSM 

The RSM-BN model is ... 

--
```{r ,out.width="100%",fig.align="center"}
knitr::include_graphics('https://i0.wp.com/www.headoverfeels.com/wp-content/uploads/2017/03/suck-it-up.gif')
```

---
name: RSM101 p1
class: left

#### Regional Simulation Model - Basins (RSMBN)

- A link-node application of the Regional Simulation Model (RSM) specific to Lake Okeechobee and Basins.

  - \>100 basins/lakes/canals represented
  
  - \>150 connections represented
  
- Used in prior planning efforts.

```{r RSM link,out.width="60%",fig.align="center",fig.cap="Link-node representation of RSM-BN model"}
knitr::include_graphics('./Plots/process/RSMBN_link.png')
```

---
name: RSM101 p2
class: center

```{r RSM map,out.width="50%",fig.align="center",fig.cap="Geographical representation of RSM-BN"}
knitr::include_graphics('./Plots/process/RSMBN_map.png')
```

* RSM-BN outputs are used in downstream processes (RSM-GL, DMSTA, etc.)

---
name: LOSOMProcess

### How it (TSP) was modeled...

```{r ,fig.align="center",out.width="100%"}

knitr::include_graphics('./Plots/process/TSP_modelled.png')
```

.small[
*From USACE PDT 12 Jan 2022 meeting presentation*
]


---
name: rslts_TOC


### Focus

* [Estuary Salinity Envelope Scores](#estuary)
  * Based on CERP RECOVER salinity envelope evaluation

* [Estuary Discharges](#estuaryQ1)
  * [Extreme discharge event and duration](#estuaryextreme1)
  * [CRE Extreme discharge event](#estuaryextreme2)
  
* [Regulatory Discharge](#regQ)

* [Lake Okeechobee](#LOK1)
  * Extreme stage metrics (> 16 Ft NGVD29, >17 Ft, < 10 Ft)
  * [Ecological Stage Envelope](#LOK3)
  * [Extreme event and duration](#LOK5)
  * [Weekly Recession rates](#LOK6) (Snail Kite PM)

* [New regulation schedule](#LORS_LOSOM)
  
---
name: estuary1

### Salinity Envelope

```{r ,fig.align="center",out.width="100%",fig.cap="Estuary salinity envelope 14-day event counts for each flow category for Caloosahatchee (top) and St. Lucie (bottom)."}

knitr::include_graphics('./Plots/Iteration3_Final/RECOVER_SalEnv_25.png')
```

---
name: estuary2

### Salinity Envelope

```{r ,fig.align="center",out.width="60%",fig.cap="Percent difference of estuary salinity envelope 14-day event counts for each flow category realtive to FWO (NA25f) for Caloosahatchee (top) and St. Lucie (bottom)."}

knitr::include_graphics('./Plots/Iteration3_Final/RECOVER_SalEnv_FWO_25.png')
```

---
name: estuaryQ1

### CRE Discharge 

```{r ,fig.align="center",out.width="85%",fig.cap="Calendar plot of monthly mean discharge from S-79 (to CRE) for existing condition (ECB19), future without (NA25f) and preferred alternative (PA25)."}

knitr::include_graphics('./Plots/Iteration3_Final/MonthQ_S79_cat_25.png')
```

---
name: estuaryQ2

### SLE Discharge 

```{r ,fig.align="center",out.width="85%",fig.cap="Calendar plot of monthly mean discharge from S-80 + other tributaries (TMC, C24 & C23; to SLE) for existing condition (ECB19), future without (NA25f) and preferred alternative (PA25)."}

knitr::include_graphics('./Plots/Iteration3_Final/MonthQ_S80_cat_25.png')
```

---
name: estuaryextreme1

### Salinity Envelope - Extreme

```{r ,fig.align="center",out.width="80%",fig.cap="Total (left) and Lake derived (right) extremem discharge events and duration for the Caloosahatchee River Estuary."}

knitr::include_graphics('./Plots/Iteration3_Final/CRE_highQ_events_25.png')
```

---
name: estuaryextreme2

### Salinity Envelope - Extreme

```{r ,fig.align="center",out.width="80%",fig.cap="Example of >90 Day (106 days) extreme event observed in the simulation period of record."}

knitr::include_graphics('./Plots/Iteration3_Final/CRE_highQ_event1998_PA25.png')
```
---
name: estuaryextreme3

### Salinity Envelope - Extreme

```{r ,fig.align="center",out.width="80%",fig.cap="Total (left) and Lake derived (right) extreme discharge events and duration for the St Lucie River Estuary."}

knitr::include_graphics('./Plots/Iteration3_Final/SLE_highQ_events_25.png')
```

---
name: regQ

### Regulatory Discharges

```{r ,fig.align="center",out.width="100%",fig.cap="Regulatory/Flood control discharge for major Lake Okeechobee outlets."}

knitr::include_graphics('./Plots/Iteration3_Final/iter3_PA_AvgFloodControl_25.png')
```

---
name: regQ2

### Regulatory Discharges

```{r ,fig.align="center",out.width="100%",fig.cap="Lake sourced discharge to CRE (left) and SLE (right) during stress and damaging flow events."}

knitr::include_graphics('./Plots/Iteration3_Final/Lakedischarge_Annualmean_25.png')
```


---
name: LOK1

### Lake Okeechobee

```{r ,fig.align="center",out.width="50%",fig.cap="Perent of time >17, >16 and <10 Ft NGVD during period of simulation"}

knitr::include_graphics('./Plots/Iteration3_Final/LOK_stg_25.png')
```

---
name: LOK2


### Lake Okeechobee

```{r ,fig.align="center",out.width="90%"}

knitr::include_graphics('./Plots/Iteration3_Final/LOK_GT17_timeline_25.png')
```

```{r ,fig.align="center",out.width="90%"}

knitr::include_graphics('./Plots/Iteration3_Final/LOK_GT17_recurrance_25.png')
```


---
name: LOK3

### Lake Okeechobee - Stage Envelope

```{r ,fig.align="center",out.width="100%",fig.cap="Normal and recovery ecological stage envelope timeline for each alternative."}
knitr::include_graphics('./Plots/Iteration3_Final/LOK_Env_25.png')
```

---
name: LOK4

### Lake Okeechobee - Stage Envelope

```{r ,fig.align="center",out.width="80%",fig.cap="LOK ecological stage envelope total scores (all years)."}
knitr::include_graphics('./Plots/Iteration3_Final/LOK_EnvScore_AllYrs_25.png')
```

---
name: LOK5

### Lake Okeechobee - Extreme Stage Events

```{r ,fig.align="center",out.width="75%",fig.cap="Lake Okeechobeee high stage events and duration."}

knitr::include_graphics('./Plots/Iteration3_Final/LOK_highstg_events_25.png')
```

---
name: LOK6

### Lake Okeechobee - weekly recession
```{r ,fig.align="center",out.width="100%",fig.cap="Calendar plot of LOK weekly recession rates (all years and days)."}
knitr::include_graphics('./Plots/Iteration3_Final/LOK_wkreccess_25.png')
```

---
name: LOK7

### Lake Okeechobee - weekly recession
```{r ,fig.align="center",out.width="100%",fig.cap="Calendar plot of LOK weekly recession rates specific to SNKI nesting period."}
knitr::include_graphics('./Plots/Iteration3_Final/LOK_wkreccess_snki_25.png')
```

---
name: Sum

### Performance Measure Summary

```{r}
PA25_sumtble=read.csv(paste0(export.path,"Iteration3/PA25Sum.csv"))
PA25_sumtble[PA25_sumtble$variable2%in%c("LOK = 17Ft","LOK = 10Ft"),"variable2"]=c("LOK \u2265 17Ft","LOK \u2264 10Ft")

vars.grn=c(paste("CRE -",c("Optimum","Stress","Damaging"),"Q Sal. Env."),paste("SLE -",c("Stress","Damaging"),"Q Sal. Env."),"S77 Reg. Discharge", "S271 Reg. Discharge", "S308 Reg. Discharge","S351+S354 Reg. Discharge")
vars.red=c("CRE - Extreme Q Sal. Env.","CRE - Extreme Q > 30 days","SLE - Extreme Q > 30 days","LOK - Stage Env.","LOK \u2265 17Ft","LOK \u2264 10Ft")


PA25_sumtble%>%
  flextable()%>%
  colformat_double(i=c(1:12,17:19),j=2:4,digits =0,big.mark = "" )%>%
  colformat_double(i=c(13:16),j=2:4,digits =1,big.mark = "" )%>%
  colformat_double(j=5,digits =1,big.mark = "" )%>%
  padding(padding=0.1,part="all")%>%
  font(fontname="Times New Roman",part="all")%>%
  fontsize(size=9,part="body")%>%
  fontsize(size=11,part="header")%>%
  bold(part="header")%>%
  set_header_labels("variable2"="Performance Measure",
                    "PA25.PerFWO"="% Diff.\nFWO")%>%
  width(width=c(1.75,0.75,0.75,0.75,0.75))%>%
  align(j=2:5,align="center",part="all")%>%
  bg(i=~variable2%in%vars.grn,j=5,bg="lightgreen")%>%
  bg(i=~variable2%in%vars.red,j=5,bg="indianred1")%>%
  footnote(j=1,
           value=as_paragraph(c("Units: Sal Env. = 14 Day periods; Extreme Q > 30 days = Events; Reg. Discharge = kAcFt Yr\u207B\u00B9; Stage Env. = Total Penalty Score; LOK \u2265 17Ft & \u2264 10Ft = Days during simulation")),
           ref_symbols = c(" 1 "),part="header")%>%
footnote(j=5,
           value=as_paragraph(c("Percent difference relative to FWO (NA25f)")),
           ref_symbols = c(" 2 "),part="header")
  


```


---
name: LORS_LOSOM

### Lake Okeechobee Regulation Schedule

```{r ,fig.align="center",out.width="100%",fig.cap="Percent of time above, within, and below Zone D of the regulation schedule."}
knitr::include_graphics('./Plots/Iteration3_Final/LORS_TSP.png')
```

---
name: LORS_LOSOM2

### Lake Okeechobee Regulation Schedule

```{r ,fig.align="center",out.width="100%",fig.cap="Distribution of daily discharge relative to Lake stages above, within and below Zone D."}
knitr::include_graphics('./Plots/Iteration3_Final/TSP_S79Q_zones_25.png')
```

---
name: LORS_LOSOM3

### Lake Okeechobee Regulation Schedule

Under LOSOM "we" should see: 

* Reduced low flow discharges to CRE

--

* Reduced stressful, and damaging discharges (from Lake) to CRE

--

* Increased optimal discharges to CRE

--

* .red[Increased extreme discharges to CRE]

--

* .red[Higher Lakes stages more frequently]

--

* Increased flows south

--

* Reduced regulatory volumes to CRE, SLE, and LWL.

---
name: LakeEval

### Application of Hydrologic Restoration Goals for a Large Subtropical Lake *(In Prep.)*

.pull-left[
Based on methodology of Havens (2002). 

Lake stage is a major driver in Lake ecology (see Conceptual Ecological Model).
.small[
* Extreme high lake stage (>5.2 m/17 Ft NGVD29)

* Moderate high lake stage (>4.9 m/16 Ft NGVD29) > 90 days

* Moderate low lake stage (<3.3 m/11 Ft NGVD29) > 90 days

* Extreme low lake stage (<3.0 m/10 Ft NGVD29)

* Spring/SNKI nest period recession
  * March 1 - June 15
  * weekly recession rate between -0.05 and 0.05 Ft/wk (0.02 m/wk) for more than 1/4th of nesting period.

* Events per decade
  
  ]
]

--

.pull-right[

.red[**Preliminary results:**]

```{r}
data.frame(Alternative=c("ECB19","NA25f","PA25"),Score=c(0.75,0.78,0.53))%>%
   flextable()%>%
  width(width=c(1,0.5))%>%
  padding(padding=0.1,part="all")%>%
  font(fontname="Times New Roman",part="all")%>%
  fontsize(size=10,part="body")%>%
  fontsize(size=12,part="header")%>%
  bold(part="header")
```


* PA25 has higher Extreme & Moderate high stage events .small[(see Extreme Event Analysis [slide](#LOK5))] lowering the score.

* LOSOM is not a restoration plan but should take into account ecology of the system. 

* Benefits to other parts of the system is balanced on the back of the Lake


]


.small[
Havens (2002) Development and Application of Hydrologic Restoration Goals for a Large Subtropical Lake. Lake and Reservoir Management 18:285–292. doi: [10.1080/07438140209353934](http://www.tandfonline.com/doi/abs/10.1080/07438140209353934)

]

---

name: LOSOMProcess

### Where we are today...

```{r ,fig.align="center",out.width="100%"}

knitr::include_graphics('./Plots/process/USACE_timeline_2.png')
```

.small[
*From USACE PDT 12 Jan 2022 meeting presentation*
]


